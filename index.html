<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Open Pulse Survey</title>
    <meta name="description" content="Enterprise Pulse Survey Platform" />
    <meta name="author" content="Tanimul Haque Khan" />

    <!-- Google tag (gtag.js) with consent mode -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5LGMS8D53W"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      // Default consent to 'denied' until user gives consent
      gtag('consent', 'default', {
        'analytics_storage': 'denied'
      });
      
      gtag('config', 'G-5LGMS8D53W');
    </script>

    <!-- Meta Pixel Code with consent check -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      
      // Initialize but don't track until consent given
      var pixelInitialized = false;
      function checkAndInitPixel() {
        var consentCookie = document.cookie.match('(^|;)\\s*analytics-consent\\s*=\\s*([^;]+)');
        var hasConsent = consentCookie ? consentCookie.pop() === 'true' : false;
        
        if (hasConsent && !pixelInitialized) {
          fbq('init', '2205817709933457');
          fbq('track', 'PageView');
          pixelInitialized = true;
        }
      }
      
      // Check on page load
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        checkAndInitPixel();
      } else {
        document.addEventListener('DOMContentLoaded', checkAndInitPixel);
      }
      
      // Also check on any cookie change
      document.addEventListener('visibilitychange', checkAndInitPixel);
    </script>
    
    <!-- SEO and social sharing -->
    <meta property="og:title" content="open-pulse-survey" />
    <meta property="og:description" content="Enterprise Pulse Survey Platform" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/og-image.png" />
    
    <!-- Performance optimizations -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="color-scheme" content="dark light" />
    <meta name="theme-color" content="#ffffff" />
    
    <!-- DNS prefetch and preconnect for external resources -->
    <link rel="dns-prefetch" href="https://cdn.gpteng.co">
    <link rel="preconnect" href="https://cdn.gpteng.co" crossorigin>
    
    <!-- Favicon -->
    <link rel="icon" href="/logo.png" type="image/png">

    <!-- Preload critical fonts and styles -->
    <link rel="preload" href="/src/index.css" as="style">
    <link rel="stylesheet" href="/src/index.css">
    
    <!-- Add preload for critical JavaScript with correct MIME type -->
    <link rel="modulepreload" href="/src/main.tsx" type="application/javascript">
    <link rel="modulepreload" href="/src/App.tsx" type="application/javascript">
    
    <!-- Preload LCP image with correct path and fetch priority -->
    <link rel="preload" as="image" href="/assets/hero-image.webp" fetchpriority="high">
    
    <!-- Disable non-essential third-party scripts during initial load -->
    <script>
      // Defer non-critical third-party scripts
      window.addEventListener('load', function() {
        // You can add code here to load non-critical scripts after page load
        // This improves initial page rendering speed
      });
    </script>
  </head>

  <body>
    <!-- Facebook Pixel noscript (moved from head to body) -->
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=2205817709933457&ev=PageView&noscript=1"
    /></noscript>
    
    <div id="root"></div>
    <!-- Load third-party scripts with appropriate attributes -->
    <script src="https://cdn.gpteng.co/gptengineer.js" defer></script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
